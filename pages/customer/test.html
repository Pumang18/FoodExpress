<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Restaurants & Menu</title>

    <!-- Bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <style>
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .content {
            /* margin-left: 220px; */
            padding: 1.5rem;
            flex: 1;
        }

        footer {
            background-color: #f8f9fa;
            padding: 0.75rem 1rem;
            text-align: center;
            border-top: 1px solid #dee2e6;
        }

        .card-img-top {
            height: 150px;
            object-fit: cover;
        }

        .menu-item-card img {
            height: 180px;
            object-fit: cover;
        }

        .hidden {
            display: none;
        }
    </style>
</head>

<body class="container mt-4">

    <!-- Top Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">üçΩÔ∏è Khanna</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
                aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <!-- <a class="nav-link" href="#" onclick="loadPage('./nrestaurants.html')">Restaurants</a> -->
                        <a class="nav-link" href="nrestaurants.html">Restaurants</a>

                    </li>
                    <li class="nav-item">
                        <!-- <a class="nav-link" href="#" onclick="loadPage('./cart.html')">Cart</a> -->
                        <a class="nav-link" href="cart.html">Cart</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('./orders.html')">My Orders</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="loadPage('./profile.html')">Profile Update</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#" onclick="logout()">Logout</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Restaurant Section -->
    <div id="restaurant-section">
        <h3 class="mb-4 mt-5">Available Restaurants</h3>
        <div class="row" id="restaurant-list"></div>
    </div>

    <!-- Menu Section -->
    <div id="menu-section" class="hidden">
        <button class="btn btn-outline-secondary mb-3 mt-5" onclick="goBack()">
            <i class="bi bi-arrow-left"></i> Back to Restaurants
        </button>
        <h3 id="menu-restaurant-name"></h3>
        <p class="text-muted" id="menu-restaurant-location"></p>
        <p class="text-muted" id="menu-restaurant-phone"></p>

        <h4 class="mt-4 mb-3">Menu</h4>
        <div class="row" id="menu-items"></div>
    </div>
    <!-- Footer -->
    <footer class="fixed-bottom">
        &copy; 2025 Khanna. All rights reserved.
    </footer>
    <script src="../js/script.js"></script>
    <script>
        apiUrl = "http://localhost:3000";
        resImages = [
            "https://assets.architecturaldigest.in/photos/6385cf3311f0276636badfb6/16:9/w_1280,c_limit/DSC_8367-Edit-W.png",
            "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/29/bc/59/20/maazi-hoi-an-s-space.jpg?w=600&h=400&s=1",
            "https://dynamic-media-cdn.tripadvisor.com/media/photo-o/2c/99/d4/4e/caption.jpg?w=600&h=400&s=1",
            "https://d4t7t8y8xqo0t.cloudfront.net/app//resized/818X450/restaurant/693504/restaurant020240216112201.jpg",
            "https://restaurantindia.s3.ap-south-1.amazonaws.com/s3fs-public/content6411.jpg",
            "https://images.axios.com/lIPBPJ802rSLL98aIQ9FDkQd2Go=/0x0:6687x3761/1920x1080/2023/04/11/1681223212336.jpg?w=3840"
        ];
        foodImages = [
            "https://images.unsplash.com/photo-1536305030588-45dc07a2a372"
            , "https://img.freepik.com/free-photo/cup-hot-cappuccino-chocolate-croissant-with-breakfast_140725-9515.jpg"
            , "https://cdn.vox-cdn.com/thumbor/FlbJZteHqF_r9D_sFxB_i7f-YIQ=/0x556:2206x2219/1200x900/filters:focal(993x1233:1345x1585):no_upscale()/cdn.vox-cdn.com/uploads/chorus_image/image/65582710/Sagar.0.jpg"
        ];

        function renderRestaurants() {
            const container = document.getElementById("restaurant-list");
            container.innerHTML = "";

            fetch(`${apiUrl}/restaurants`)
                .then(response => response.json())
                .then(restaurants => {
                    restaurants.forEach(restaurant => {
                        const col = document.createElement("div");
                        col.className = "col-md-3";
                        col.innerHTML = `
              <div class="card mb-2 shadow-sm">
                <img src="${resImages[Math.floor(Math.random() * resImages.length)]}" class="card-img-top" alt="${restaurant.name}">
                <div class="card-body">
                  <h5 class="card-title fs-5 mb-3">${restaurant.name}</h5>
                  <p class="card-text mb-2 text-muted">
                    <i class="bi bi-geo-alt-fill me-2"></i>${restaurant.location}
                  </p>
                  <p class="card-text text-muted">
                    <i class="bi bi-telephone-fill me-2"></i>+91 ${restaurant.phone}
                  </p>
                  <button class="btn btn-primary mt-3" onclick="viewMenu('${restaurant.id}')">View Menu</button>
                </div>
              </div>
            `;
                        container.appendChild(col);
                    });
                });
        }

        function viewMenu(restaurantId) {
            const restaurantSection = document.getElementById("restaurant-section");
            const menuSection = document.getElementById("menu-section");
            restaurantSection.classList.add("hidden");
            menuSection.classList.remove("hidden");

            // Get restaurant details
            fetch(`${apiUrl}/restaurants`)
                .then(res => res.json())
                .then(restaurants => {
                    const restaurant = restaurants.find(r => r.id === restaurantId);
                    document.getElementById("menu-restaurant-name").textContent = restaurant.name;
                    document.getElementById("menu-restaurant-location").textContent = restaurant.location;
                    document.getElementById("menu-restaurant-phone").textContent = "+91 " + restaurant.phone;
                });

            // Get menu items
            fetch(`${apiUrl}/fooditems`)
                .then(res => res.json())
                .then(items => {
                    const menuItems = items.filter(item => item.restaurantID === restaurantId);
                    const container = document.getElementById("menu-items");
                    container.innerHTML = "";

                    if (menuItems.length === 0) {
                        container.innerHTML = "<p class='text-muted'>No menu items available for this restaurant.</p>";
                        return;
                    }

                    menuItems.forEach(item => {
                        const col = document.createElement("div");

                        col.className = "col-md-4";
                        col.innerHTML = `
              <div class="card mb-4 shadow-sm menu-item-card">
                <img src="${foodImages[Math.floor(Math.random() * foodImages.length)]}" class="card-img-top" alt="${item.name}">
                <div class="card-body">
                  <h5 class="card-title">${item.name}</h5>
                  <p class="card-text text-muted">${item.category}</p>
                  <p class="card-text fw-bold">‚Çπ${item.price}</p>
                  <button class="btn btn-sm btn-outline-primary" onclick='addToCart(${JSON.stringify(item)})'>Add to Cart</button>
                </div>
              </div>
            `;
                        container.appendChild(col);
                    });
                });
        }

        function goBack() {
            document.getElementById("menu-section").classList.add("hidden");
            document.getElementById("restaurant-section").classList.remove("hidden");
        }

        // Load on page start
        renderRestaurants();
        cartItems = [];

        function addToCart(item) {
            userId = localStorage.getItem("currentUserId");
            if (!userId) {
                alert("Please log in first.");
                return;
            }

            cartKey = `cart_${userId}`;
            cartItems = JSON.parse(localStorage.getItem(cartKey)) || [];

            existingItemIndex = cartItems.findIndex(cartItem => cartItem.id === item.id);
            console.log(existingItemIndex)
            if (existingItemIndex !== -1) {
                // Item already in cart, just increase the quantity
                cartItems[existingItemIndex].quantity += 1;
            } else {
                // Clone the item and add quantity = 1
                newItem = {
                    id: item.id,
                    name: item.name,
                    price: item.price,
                    category: item.category,
                    restaurantID: item.restaurantID,
                    quantity: 1
                };
                cartItems.push(newItem);
            }

            localStorage.setItem(cartKey, JSON.stringify(cartItems));
            alert(`${item.name} added to cart!`);
        }



    </script>
</body>

</html>