<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Restaurant Menu - FoodExpress</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link href="../../css/style.css" rel="stylesheet" />
  </head>
  <body>
    <!-- Navbar -->

    <div class="container mt-4">
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="home.html">Restaurants</a></li>
          <li
            class="breadcrumb-item active"
            aria-current="page"
            id="restaurant-name"
          >
            Restaurant Name
          </li>
        </ol>
      </nav>

      <div class="card mb-4">
        <div class="card-body">
          <div class="row">
            <div class="col-md-4 text-center text-md-start">
              <img
                src="https://via.placeholder.com/300x200"
                class="img-fluid rounded"
                id="restaurant-image"
                alt="Restaurant"
              />
            </div>
            <div class="col-md-8">
              <div class="d-flex justify-content-between align-items-center">
                <h2 id="restaurant-title">Restaurant Name</h2>
              </div>
              <p>
                <i class="fas fa-map-marker-alt text-primary me-2"></i>
                <span id="restaurant-location">Location</span>
              </p>
              <p>
                <i class="fas fa-phone text-primary me-2"></i>
                <span id="restaurant-contact">Contact</span>
              </p>
            </div>
          </div>
        </div>
      </div>
      <div class="row mb-4">
        <div class="col-12">
          <ul class="nav nav-pills" id="menuCategories" role="tablist">
            <li class="nav-item" role="presentation">
              <button
                class="nav-link active"
                id="appetizers-tab"
                data-bs-toggle="tab"
                data-bs-target="#appetizers"
                type="button"
                role="tab"
              >
                Appetizers
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="main-courses-tab"
                data-bs-toggle="tab"
                data-bs-target="#main-courses"
                type="button"
                role="tab"
              >
                Main Courses
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="desserts-tab"
                data-bs-toggle="tab"
                data-bs-target="#desserts"
                type="button"
                role="tab"
              >
                Desserts
              </button>
            </li>
            <li class="nav-item" role="presentation">
              <button
                class="nav-link"
                id="drinks-tab"
                data-bs-toggle="tab"
                data-bs-target="#drinks"
                type="button"
                role="tab"
              >
                Drinks
              </button>
            </li>
          </ul>
        </div>
      </div>

      <div class="tab-content" id="menuContent">
        <div class="tab-pane fade show active" id="appetizers" role="tabpanel">
          <div class="row" id="appetizers-list">
            <!-- Appetizer items will be loaded here -->
          </div>
        </div>
        <div class="tab-pane fade" id="main-courses" role="tabpanel">
          <div class="row" id="main-courses-list">
            <!-- Main course items will be loaded here -->
          </div>
        </div>
        <div class="tab-pane fade" id="desserts" role="tabpanel">
          <div class="row" id="desserts-list">
            <!-- Dessert items will be loaded here -->
          </div>
        </div>
        <div class="tab-pane fade" id="drinks" role="tabpanel">
          <div class="row" id="drinks-list">
            <!-- Drink items will be loaded here -->
          </div>
        </div>
      </div>
    </div>

    <!-- View Cart Floating Button -->
    <div class="position-fixed bottom-0 end-0 m-4">
      <a href="cart.html" class="btn btn-primary rounded-circle p-3 shadow">
        <i class="fas fa-shopping-cart fa-lg"></i>
        <span
          class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger cart-count"
          >0</span
        >
      </a>
    </div>

    <!-- Footer -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- <script src="../../js/restaurant.js"></script> -->
    <script>
      console.log("executing");
      document.addEventListener("DOMContentLoaded", async () => {
        console.log("executing");
        const urlParams = new URLSearchParams(window.location.search);
        const restaurantId = urlParams.get("id");
        console.log(restaurantId);

        let foodItemsData, restaurantsData;
        try {
          const [foodRes, restRes] = await Promise.all([
            fetch("http://localhost:3000/foodItems"),
            fetch("http://localhost:3000/restaurants"),
          ]);
          foodItemsData = await foodRes.json();
          restaurantsData = await restRes.json();
        } catch (error) {
          console.error("Error fetching data:", error);
          return;
        }
        console.log(foodItemsData);
        console.log(restaurantsData);
        const currentRestaurant = restaurantsData.find(
          (r) => r.id == restaurantId
        );
        console.log(currentRestaurant);
        if (!currentRestaurant) return;

        // Update restaurant info
        document.getElementById("restaurant-name").textContent =
          currentRestaurant.name;
        document.getElementById("restaurant-title").textContent =
          currentRestaurant.name;
        document.getElementById("restaurant-location").textContent =
          currentRestaurant.location;
        document.getElementById("restaurant-contact").textContent =
          currentRestaurant.contact;

        // Filter food items by restaurant
        const filteredItems = foodItemsData.filter(
          (item) => item.restaurantId === restaurantId
        );

        const categories = ["appetizers", "main-courses", "desserts", "drinks"];
        categories.forEach((category) => {
          const categoryItems = filteredItems.filter(
            (item) => item.category === category
          );
          const container = document.getElementById(`${category}-list`);
          if (!container) return;

          container.innerHTML = "";
          categoryItems.forEach((item) => {
            const itemCard = `
                <div class="col-md-4 mb-4">
                  <div class="card h-100 shadow-sm">
                    <div class="card-body">
                      <h5 class="card-title">${item.name}</h5>
                      <p class="card-text text-muted">Price: ₹${item.price}</p>
                      <div class="input-group mb-3">
                        <button class="btn btn-outline-secondary" type="button" onclick="decreaseQty(this)">−</button>
                        <input type="text" class="form-control text-center" value="1" readonly />
                        <button class="btn btn-outline-secondary" type="button" onclick="increaseQty(this)">+</button>
                      </div>
                      <button class="btn btn-primary w-100 add-to-cart"
                              data-id="${item.id}"
                              data-name="${item.name}"
                              data-price="${item.price}">
                        Add to Cart
                      </button>
                    </div>
                  </div>
                </div>
            `;
            container.innerHTML += itemCard;
          });
        });

        // Initialize cart
        let cart = JSON.parse(localStorage.getItem("cart")) || [];
        updateCartCount();

        // Add to Cart
     
        document.querySelectorAll(".add-to-cart").forEach((button) => {
          button.addEventListener("click", function () {
            const itemId = this.getAttribute("data-id");
            const itemName = this.getAttribute("data-name");
            const itemPrice = parseFloat(this.getAttribute("data-price"));
            const card = this.closest(".card");
            const quantity = parseInt(card.querySelector("input").value);

            const currentRestaurantName = currentRestaurant.name;

            // Check for different restaurant
            if (
              cart.length > 0 &&
              cart[0].restaurant !== currentRestaurantName
            ) {
              const proceed = confirm(
                `Your cart contains items from "${cart[0].restaurant}".\n` +
                  `Do you want to clear the cart and add items from "${currentRestaurantName}" instead?`
              );
              if (!proceed) return;

              // Clear cart
              cart = [];
            }

            const existingItem = cart.find((item) => item.id === itemId);

            if (existingItem) {
              existingItem.quantity += quantity;
            } else {
              cart.push({
                id: itemId,
                name: itemName,
                price: itemPrice,
                quantity: quantity,
                restaurant: currentRestaurantName,
              });
            }

            localStorage.setItem("cart", JSON.stringify(cart));
            updateCartCount();

            this.innerHTML = '<i class="fas fa-check"></i> Added';
            this.classList.remove("btn-primary");
            this.classList.add("btn-success");
            setTimeout(() => {
              this.innerHTML = "Add to Cart";
              this.classList.remove("btn-success");
              this.classList.add("btn-primary");
            }, 1500);
          });
        });

        function updateCartCount() {
          const totalItems = cart.reduce(
            (total, item) => total + item.quantity,
            0
          );
          localStorage.setItem("cartCount", totalItems);
          document.querySelectorAll(".cart-count").forEach((el) => {
            el.textContent = totalItems;
          });
        }
      });

      // Quantity functions
      function increaseQty(btn) {
        const input = btn.parentElement.querySelector("input");
        input.value = parseInt(input.value) + 1;
      }
      function decreaseQty(btn) {
        const input = btn.parentElement.querySelector("input");
        if (parseInt(input.value) > 1) {
          input.value = parseInt(input.value) - 1;
        }
      }
    </script>
  </body>
</html>
